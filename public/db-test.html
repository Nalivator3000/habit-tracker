<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowHabits - Testing Lab</title>
    <style>
        /* ===== DESIGN SYSTEM 2025 ===== */
        :root {
            /* Dark Theme Colors */
            --bg-primary: #0A0A0F;
            --bg-secondary: #121218;
            --bg-tertiary: #1A1A24;

            /* Glassmorphism */
            --glass-light: rgba(255, 255, 255, 0.05);
            --glass-medium: rgba(255, 255, 255, 0.08);
            --glass-dark: rgba(0, 0, 0, 0.25);
            --glass-border: rgba(255, 255, 255, 0.12);

            /* AI-Inspired Gradients */
            --gradient-neural: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);

            /* Depth & Shadows */
            --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.37);
            --shadow-elevated: 0 15px 35px rgba(0, 0, 0, 0.5);
            --shadow-floating: 0 25px 50px rgba(0, 0, 0, 0.6);

            /* Typography */
            --font-display: -apple-system-ui-serif, ui-serif, 'SF Pro Display', system-ui;
            --font-body: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui;

            /* Animations */
            --transition-smooth: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-bounce: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg-primary);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 2rem 1rem;
        }

        /* ===== ANIMATED BACKGROUND ===== */
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: var(--gradient-neural);
            opacity: 0.08;
            animation: gradientShift 20s ease infinite;
        }

        .bg-animated::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(245, 101, 108, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            animation: float 25s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-15px) rotate(0.5deg); }
            66% { transform: translateY(8px) rotate(-0.5deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-glass);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-neural);
        }

        .header h1 {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-neural);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 6s ease infinite;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: rgba(255, 255, 255, 0.6);
            margin-top: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .nav-link {
            background: var(--glass-dark);
            border: 1px solid var(--glass-border);
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 0.75rem 1.25rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-link:hover {
            background: var(--glass-medium);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glass);
        }

        .nav-link.active {
            background: var(--gradient-neural);
            border-color: transparent;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .test-button {
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: var(--transition-smooth);
            box-shadow: var(--shadow-glass);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .test-button:hover:not(:disabled) {
            background: var(--glass-medium);
            transform: translateY(-2px);
            box-shadow: var(--shadow-elevated);
        }

        .test-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .test-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .test-button.primary {
            background: var(--gradient-neural);
            border-color: transparent;
        }

        .test-button.danger {
            background: var(--gradient-danger);
            border-color: transparent;
        }

        .test-section {
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-glass);
        }

        .test-section h3 {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: white;
        }

        .manual-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .manual-controls input {
            background: var(--glass-dark);
            border: 1px solid var(--glass-border);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            font-size: 0.95rem;
            min-width: 200px;
            transition: var(--transition-smooth);
        }

        .manual-controls input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .manual-controls input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            background: var(--glass-light);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .results {
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
            box-shadow: var(--shadow-glass);
        }

        .results::-webkit-scrollbar {
            width: 8px;
        }

        .results::-webkit-scrollbar-track {
            background: var(--glass-dark);
            border-radius: 10px;
        }

        .results::-webkit-scrollbar-thumb {
            background: var(--glass-border);
            border-radius: 10px;
        }

        .results::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .test-result {
            margin: 1rem 0;
            padding: 1.25rem;
            border-radius: 12px;
            border-left: 4px solid;
            background: var(--glass-dark);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .test-result.error {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .test-result.success {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .test-result.loading {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .test-title {
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: space-between;
        }

        .test-title small {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 500;
            font-size: 0.8rem;
        }

        .test-data {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
            color: #10b981;
            border: 1px solid var(--glass-border);
        }

        .loading-placeholder {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
            padding: 2rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background-color: #10b981; box-shadow: 0 0 10px #10b981; }
        .status-error { background-color: #ef4444; box-shadow: 0 0 10px #ef4444; }
        .status-loading {
            background-color: #f59e0b;
            box-shadow: 0 0 10px #f59e0b;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Build Version Badge */
        .build-version-badge {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: var(--glass-dark);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 500;
            z-index: 1000;
            user-select: none;
            pointer-events: none;
            opacity: 0.7;
        }

        .build-version-badge .build-label {
            color: rgba(255, 255, 255, 0.5);
            margin-right: 0.25rem;
        }

        .build-version-badge .build-number {
            background: var(--gradient-neural);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
            }

            .header {
                padding: 1.5rem;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .manual-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .manual-controls input {
                width: 100%;
            }

            .results {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animated"></div>

    <div class="container">
        <div class="header">
            <h1>🧪 Testing Lab</h1>
            <p>Comprehensive testing interface for FlowHabits</p>
            <div class="nav-links">
                <a href="/app.html" class="nav-link">✨ Dashboard</a>
                <a href="/calendar.html" class="nav-link">📅 Calendar</a>
                <a href="/db-test.html" class="nav-link active">🔧 Testing</a>
            </div>
        </div>

        <div class="quick-actions">
            <button class="test-button primary" onclick="runAllTests()">🚀 Run All Tests</button>
            <button class="test-button" onclick="runDatabaseTest()">📊 Database Structure</button>
            <button class="test-button" onclick="testHabitLogging()">✅ Habit Logging</button>
            <button class="test-button" onclick="testHabitCRUD()">🔄 CRUD Operations</button>
            <button class="test-button" onclick="testUIElements()">🎨 UI Elements</button>
            <button class="test-button" onclick="testFormValidation()">📝 Form Validation</button>
            <button class="test-button" onclick="testResponseHandling()">🌐 API Responses</button>
            <button class="test-button" onclick="testFrequencySystem()">📅 Frequency System</button>
            <button class="test-button" onclick="testDatabaseMigration()">🔄 Schema Migration</button>
            <button class="test-button danger" onclick="resetDatabase()">🧹 Reset Database</button>
            <button class="test-button" onclick="clearResults()">🗑️ Clear Results</button>
        </div>

        <div class="test-section">
            <h3>Manual Testing</h3>
            <div class="manual-controls">
                <input type="text" id="habitId" placeholder="Habit ID (e.g., 1, 2, 3...)">
                <button class="test-button" onclick="logHabitCompletion()">✅ Mark Complete</button>
                <button class="test-button danger" onclick="deleteHabit()">🗑️ Delete Habit</button>
            </div>
        </div>

        <div class="results" id="results">
            <p class="loading-placeholder">Click a test button to start testing...</p>
        </div>
    </div>

    <!-- Build Version Badge -->
    <div class="build-version-badge">
        <span class="build-label">Build:</span>
        <span class="build-number">v2025.1-glassmorphism</span>
    </div>

    <script>
        const API_BASE = '/api/habits';
        let testResults = [];

        async function fetchAPI(endpoint, options = {}) {
            const response = await fetch(API_BASE + endpoint, {
                headers: { 'Content-Type': 'application/json' },
                ...options
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            return await response.json();
        }

        function addResult(title, status, data = null) {
            const result = {
                title,
                status,
                data,
                timestamp: new Date().toISOString()
            };
            testResults.push(result);
            renderResults();
        }

        function renderResults() {
            const container = document.getElementById('results');

            if (testResults.length === 0) {
                container.innerHTML = '<p class="loading-placeholder">Click a test button to start testing...</p>';
                return;
            }

            container.innerHTML = testResults.map(result => `
                <div class="test-result ${result.status}">
                    <div class="test-title">
                        <span>
                            <span class="status-indicator status-${result.status}"></span>
                            ${result.title}
                        </span>
                        <small>${new Date(result.timestamp).toLocaleTimeString()}</small>
                    </div>
                    ${result.data ? `<div class="test-data">${JSON.stringify(result.data, null, 2)}</div>` : ''}
                </div>
            `).join('');

            container.scrollTop = container.scrollHeight;
        }

        async function runDatabaseTest() {
            addResult('Database Structure Test', 'loading');
            try {
                const response = await fetchAPI('/db-test');
                addResult('Database Structure Test ✅', 'success', response);
            } catch (error) {
                addResult('Database Structure Test ❌', 'error', { error: error.message });
            }
        }

        async function testHabitLogging() {
            addResult('Habit Logging Test', 'loading');
            try {
                const response = await fetchAPI('/1/log', {
                    method: 'POST',
                    body: JSON.stringify({
                        date: new Date().toISOString().split('T')[0],
                        status: 'completed',
                        completion_count: 1,
                        notes: 'Test from interface'
                    })
                });
                addResult('Habit Logging Test ✅', 'success', response);
            } catch (error) {
                addResult('Habit Logging Test ❌', 'error', { error: error.message });
            }
        }

        async function testHabitCRUD() {
            addResult('CRUD Operations Test', 'loading');
            try {
                const getResponse = await fetchAPI('/');
                addResult('GET Habits ✅', 'success', { count: getResponse.habits.length, habits: getResponse.habits });

                const todayResponse = await fetchAPI('/logs/today');
                addResult('GET Today Logs ✅', 'success', { count: todayResponse.count, logs: todayResponse.logs });
            } catch (error) {
                addResult('CRUD Operations Test ❌', 'error', { error: error.message });
            }
        }

        async function logHabitCompletion() {
            const habitId = document.getElementById('habitId').value || '1';
            addResult(`Manual: Log Habit ${habitId}`, 'loading');

            try {
                const response = await fetchAPI(`/${habitId}/log`, {
                    method: 'POST',
                    body: JSON.stringify({
                        date: new Date().toISOString().split('T')[0],
                        status: 'completed',
                        completion_count: 1,
                        notes: `Manual test: ${new Date().toLocaleTimeString()}`
                    })
                });
                addResult(`Manual: Log Habit ${habitId} ✅`, 'success', response);
            } catch (error) {
                addResult(`Manual: Log Habit ${habitId} ❌`, 'error', { error: error.message });
            }
        }

        async function deleteHabit() {
            const habitId = document.getElementById('habitId').value || '1';
            if (!confirm(`Are you sure you want to delete habit ${habitId}?`)) return;

            addResult(`Manual: Delete Habit ${habitId}`, 'loading');

            try {
                const response = await fetchAPI(`/${habitId}`, { method: 'DELETE' });
                addResult(`Manual: Delete Habit ${habitId} ✅`, 'success', response);
            } catch (error) {
                addResult(`Manual: Delete Habit ${habitId} ❌`, 'error', { error: error.message });
            }
        }

        async function runAllTests() {
            testResults = [];
            addResult('Starting comprehensive test suite...', 'loading');

            await runDatabaseTest();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testHabitCRUD();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testHabitLogging();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testUIElements();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testFormValidation();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testResponseHandling();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testFrequencySystem();
            await new Promise(resolve => setTimeout(resolve, 500));

            await testDatabaseMigration();

            addResult('All tests completed! 🎉', 'success');
        }

        async function testUIElements() {
            addResult('UI Elements Test', 'loading');
            try {
                const uiTests = [
                    {
                        name: 'Testing Interface Container',
                        test: () => document.querySelector('.container') !== null,
                        expected: true
                    },
                    {
                        name: 'Test Results Area',
                        test: () => document.getElementById('results') !== null,
                        expected: true
                    },
                    {
                        name: 'Test Buttons Available',
                        test: () => {
                            const buttons = document.querySelectorAll('.test-button');
                            return buttons.length >= 5;
                        },
                        expected: true
                    },
                    {
                        name: 'API Base Configuration',
                        test: () => {
                            return typeof API_BASE !== 'undefined' && API_BASE === '/api/habits';
                        },
                        expected: true
                    }
                ];

                const results = [];
                for (const test of uiTests) {
                    const result = test.test();
                    results.push({
                        name: test.name,
                        result: result,
                        passed: result === test.expected
                    });
                }

                const allPassed = results.every(r => r.passed);
                addResult(`UI Elements Test ${allPassed ? '✅' : '❌'}`, allPassed ? 'success' : 'error', results);
            } catch (error) {
                addResult('UI Elements Test ❌', 'error', { error: error.message });
            }
        }

        async function testFormValidation() {
            addResult('Form Validation Test', 'loading');
            try {
                const validationTests = [
                    {
                        name: 'Empty Form Submission',
                        test: async () => {
                            try {
                                const response = await fetchAPI('/', {
                                    method: 'POST',
                                    body: JSON.stringify({})
                                });
                                return false;
                            } catch (error) {
                                return error.message.includes('400') || error.message.includes('Validation');
                            }
                        },
                        shouldFail: false
                    },
                    {
                        name: 'Valid Habit Creation Data',
                        test: async () => {
                            try {
                                const response = await fetchAPI('/', {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        name: 'Test Habit ' + Date.now(),
                                        description: 'Test Description',
                                        frequency_type: 'daily',
                                        target_count: 1,
                                        difficulty_level: 3,
                                        color: '#10B981'
                                    })
                                });
                                return response.success;
                            } catch (error) {
                                console.error('Valid habit creation failed:', error);
                                return false;
                            }
                        },
                        shouldFail: false
                    },
                    {
                        name: 'Invalid Habit ID Logging',
                        test: async () => {
                            try {
                                const response = await fetchAPI('/999/log', {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        date: new Date().toISOString().split('T')[0],
                                        status: 'completed'
                                    })
                                });
                                return false;
                            } catch (error) {
                                return error.message.includes('foreign key') ||
                                       error.message.includes('violates') ||
                                       error.message.includes('500');
                            }
                        },
                        shouldFail: false
                    }
                ];

                const results = [];
                for (const test of validationTests) {
                    try {
                        const result = await test.test();
                        const passed = test.shouldFail ? !result : result;
                        results.push({
                            name: test.name,
                            passed: passed,
                            expectedFail: test.shouldFail,
                            actualResult: result
                        });
                    } catch (error) {
                        const passed = test.shouldFail;
                        results.push({
                            name: test.name,
                            passed: passed,
                            expectedFail: test.shouldFail,
                            error: error.message
                        });
                    }
                }

                const allPassed = results.every(r => r.passed);
                addResult(`Form Validation Test ${allPassed ? '✅' : '❌'}`, allPassed ? 'success' : 'error', results);
            } catch (error) {
                addResult('Form Validation Test ❌', 'error', { error: error.message });
            }
        }

        async function testResponseHandling() {
            addResult('API Response Handling Test', 'loading');
            try {
                const responseTests = [
                    {
                        name: 'Valid API Endpoints Response Format',
                        endpoint: '/',
                        expectedFields: ['success', 'habits', 'count']
                    },
                    {
                        name: 'Today Logs Response Format',
                        endpoint: '/logs/today',
                        expectedFields: ['success', 'logs', 'count', 'date']
                    },
                    {
                        name: 'Database Test Response Format',
                        endpoint: '/db-test',
                        expectedFields: ['success', 'message', 'results']
                    }
                ];

                const results = [];
                for (const test of responseTests) {
                    try {
                        const response = await fetchAPI(test.endpoint);
                        const hasAllFields = test.expectedFields.every(field =>
                            response.hasOwnProperty(field)
                        );

                        results.push({
                            endpoint: test.endpoint,
                            name: test.name,
                            passed: hasAllFields,
                            missingFields: test.expectedFields.filter(field =>
                                !response.hasOwnProperty(field)
                            ),
                            responseKeys: Object.keys(response)
                        });
                    } catch (error) {
                        results.push({
                            endpoint: test.endpoint,
                            name: test.name,
                            passed: false,
                            error: error.message
                        });
                    }
                }

                const allPassed = results.every(r => r.passed);
                addResult(`API Response Handling Test ${allPassed ? '✅' : '❌'}`, allPassed ? 'success' : 'error', results);
            } catch (error) {
                addResult('API Response Handling Test ❌', 'error', { error: error.message });
            }
        }

        async function resetDatabase() {
            if (!confirm('Are you sure you want to reset the entire database? This will delete all habits and logs!')) {
                return;
            }

            addResult('Database Reset', 'loading');
            try {
                const response = await fetchAPI('/reset-database', { method: 'POST' });
                addResult('Database Reset ✅', 'success', response);

                setTimeout(async () => {
                    await runDatabaseTest();
                }, 2000);
            } catch (error) {
                addResult('Database Reset ❌', 'error', { error: error.message });
            }
        }

        function clearResults() {
            testResults = [];
            renderResults();
        }

        async function testDatabaseMigration() {
            addResult('Database Migration Test', 'loading');
            try {
                const response = await fetchAPI('/update-frequency-schema', {
                    method: 'POST'
                });
                addResult('Database Migration Test ✅', 'success', response);
            } catch (error) {
                addResult('Database Migration Test ❌', 'error', { error: error.message });
            }
        }

        async function testFrequencySystem() {
            addResult('Frequency System Test', 'loading');

            try {
                const frequencyTestData = [
                    {
                        name: 'Daily 3x Test',
                        description: 'Daily habit 3 times per day',
                        frequency_type: 'daily',
                        target_count: 3,
                        difficulty_level: 3,
                        color: '#10B981'
                    },
                    {
                        name: 'Every 3 Days Test',
                        description: 'Every 3 days habit',
                        frequency_type: 'every_n_days',
                        frequency_value: 3,
                        target_count: 1,
                        difficulty_level: 2,
                        color: '#3B82F6'
                    },
                    {
                        name: 'Weekly Test',
                        description: 'Weekly habit',
                        frequency_type: 'weekly',
                        target_count: 1,
                        difficulty_level: 4,
                        color: '#F59E0B'
                    },
                    {
                        name: 'Monthly Test',
                        description: 'Monthly on 15th',
                        frequency_type: 'monthly',
                        frequency_value: 15,
                        target_count: 1,
                        difficulty_level: 5,
                        color: '#EF4444'
                    },
                    {
                        name: 'Yearly Test',
                        description: 'Yearly on Jan 1',
                        frequency_type: 'yearly',
                        schedule_dates: ['01-01'],
                        target_count: 1,
                        difficulty_level: 1,
                        color: '#8B5CF6'
                    },
                    {
                        name: 'Schedule Test',
                        description: 'Custom schedule habit',
                        frequency_type: 'schedule',
                        schedule_dates: ['2024-01-01', '2024-01-15', '2024-02-01'],
                        target_count: 1,
                        difficulty_level: 3,
                        color: '#EC4899'
                    }
                ];

                const results = [];

                for (const habitData of frequencyTestData) {
                    try {
                        const response = await fetchAPI('/', {
                            method: 'POST',
                            body: JSON.stringify({
                                ...habitData,
                                name: habitData.name + ' ' + Date.now()
                            })
                        });

                        results.push({
                            frequency_type: habitData.frequency_type,
                            name: habitData.name,
                            created: response.success,
                            response: response
                        });

                        await new Promise(resolve => setTimeout(resolve, 100));
                    } catch (error) {
                        results.push({
                            frequency_type: habitData.frequency_type,
                            name: habitData.name,
                            created: false,
                            error: error.message
                        });
                    }
                }

                addResult('Frequency Habit Creation ✅', 'success', {
                    totalTests: frequencyTestData.length,
                    successful: results.filter(r => r.created).length,
                    failed: results.filter(r => !r.created).length,
                    results: results
                });

                await testFrequencyValidation();
            } catch (error) {
                addResult('Frequency System Test ❌', 'error', { error: error.message });
            }
        }

        async function testFrequencyValidation() {
            addResult('Frequency Validation Test', 'loading');

            try {
                const validationTests = [
                    {
                        name: 'Invalid Frequency Type',
                        data: {
                            name: 'Invalid Test',
                            frequency_type: 'invalid_type'
                        },
                        shouldFail: true
                    },
                    {
                        name: 'Every N Days without Value',
                        data: {
                            name: 'Every N Test',
                            frequency_type: 'every_n_days'
                        },
                        shouldFail: true
                    },
                    {
                        name: 'Monthly without Day',
                        data: {
                            name: 'Monthly Test',
                            frequency_type: 'monthly'
                        },
                        shouldFail: true
                    },
                    {
                        name: 'Schedule without Dates',
                        data: {
                            name: 'Schedule Test',
                            frequency_type: 'schedule',
                            schedule_dates: []
                        },
                        shouldFail: true
                    },
                    {
                        name: 'Valid Daily Habit',
                        data: {
                            name: 'Valid Daily Test ' + Date.now(),
                            frequency_type: 'daily',
                            target_count: 1
                        },
                        shouldFail: false
                    }
                ];

                const results = [];
                for (const test of validationTests) {
                    try {
                        const response = await fetchAPI('/', {
                            method: 'POST',
                            body: JSON.stringify(test.data)
                        });

                        results.push({
                            name: test.name,
                            shouldFail: test.shouldFail,
                            actuallyFailed: false,
                            passed: !test.shouldFail,
                            response: response
                        });
                    } catch (error) {
                        results.push({
                            name: test.name,
                            shouldFail: test.shouldFail,
                            actuallyFailed: true,
                            passed: test.shouldFail,
                            error: error.message
                        });
                    }

                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                const allPassed = results.every(r => r.passed);
                addResult(`Frequency Validation Test ${allPassed ? '✅' : '❌'}`,
                         allPassed ? 'success' : 'error', results);
            } catch (error) {
                addResult('Frequency Validation Test ❌', 'error', { error: error.message });
            }
        }

        // Initialize
        renderResults();
    </script>
</body>
</html>